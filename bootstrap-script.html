<!-- Підключення бібліотек -->
<!-- jQuery для спрощення роботи з DOM та AJAX -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Bootstrap CSS для стилізації інтерфейсу -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<!-- Bootstrap JS для інтерактивних компонентів, таких як модальні вікна, випадаючі списки тощо -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

<!-- DataTables для створення інтерактивних таблиць (версія 2) -->
<link href="https://cdn.datatables.net/v/dt/dt-2.1.8/b-3.2.1/sl-2.1.0/datatables.min.css" rel="stylesheet">
<script src="https://cdn.datatables.net/v/dt/dt-2.1.8/b-3.2.1/sl-2.1.0/datatables.min.js"></script>

<!-- DataTables (старіша версія) для додаткових функцій, таких як адаптивність -->
<script src="https://cdn.datatables.net/1.10.23/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.23/js/dataTables.bootstrap4.min.js"></script>
<script src="https://cdn.datatables.net/responsive/2.2.9/js/dataTables.responsive.min.js"></script>
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.10.25/js/jquery.dataTables.min.js"></script>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.23/css/dataTables.bootstrap4.min.css">
<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.25/css/jquery.dataTables.min.css">

<script>
  // Псевдонім для console.log для зручності використання
  const k = console.log.bind(document);

  // Відображає анімацію завантаження у вказаному елементі
  function spinner(elemId, text = 'Іде пошук...') {
    document.getElementById(elemId).innerHTML = `
      <div class="d-flex justify-content-center">
        <div class="spinner-border text-danger mb-4 mt-2" role="status">
          <span class="visually-hidden"></span>
        </div>
        ${text}
      </div>
    `;
  }

  // Заповнює елемент <datalist> опціями на основі масиву
  function afterDropDownReturned(arrayOfArrays, datalist) {
    if (!arrayOfArrays) return false;
    let selectorDatalist = document.getElementById(datalist);
    if (selectorDatalist) {
      selectorDatalist.innerHTML = ''; // Очищаємо вміст datalist
      arrayOfArrays.forEach((r) => {
        const selectorOption = document.createElement('option'); // Створюємо новий елемент <option>
        selectorOption.textContent = r; // Встановлюємо текст опції
        selectorDatalist.appendChild(selectorOption); // Додаємо опцію до datalist
      });
    }
  }

  // Автосховання розгортаючогося меню при кліку на посилання
  $(function () {
    var navMain = $('.navbar-collapse');
    navMain.on('click', 'a:not([data-toggle])', null, function () {
      navMain.collapse('hide'); // Ховаємо меню
    });
  });

  // Ховає кнопку з ID "btnBuh" на мобільних пристроях
  function hideBtnBuh() {
    searchMobileNot(() => $('#btnBuh').hide(1000)); // Ховаємо кнопку з анімацією
  }

  // Показує кнопку з ID "btnBuh"
  function showBtnBuh() {
    $('#btnBuh').show(500); // Показуємо кнопку з анімацією
  }

  // Перевіряє, чи всі критерії пошуку порожні, зупиняє пошук якщо так
  function searchStop(dataArr) {
    let evalRows = [];
    dataArr.forEach(elem => {
      evalRows.push(elem === '' || elem === false ? 'no' : 'yes'); // Формуємо масив 'yes'/'no'
    });
    return evalRows.indexOf('yes') === -1; // Повертаємо true, якщо немає 'yes'
  }

  // Перетворює рядок дати "dd.mm.yyyy" в об’єкт Date
  function strongToDate(st) {
    const pattern = /(\d{2})\.(\d{2})\.(\d{4})/;
    return new Date(st.replace(pattern, '$3-$2-$1')); // Перетворюємо у формат yyyy-mm-dd
  }

  // Форматує дату у "yyyy-mm-dd"
  function formatDateYYYYtireMMtireDD(date) {
    return date.getFullYear() + '-' +
      ((date.getMonth() + 1) < 10 ? '0' : '') + (date.getMonth() + 1) + '-' +
      (date.getDate() < 10 ? '0' : '') + date.getDate();
  }

  // Форматує дату у "dd-mm-yyyy"
  function formatDateDDtireMMtireYYYY(date) {
    return (date.getDate() < 10 ? '0' : '') + date.getDate() + '-' +
      ((date.getMonth() + 1) < 10 ? '0' : '') + (date.getMonth() + 1) + '-' +
      date.getFullYear();
  }

  // Форматує дату у "dd.mm.yyyy"
  function formatDateDDpointMMpointYYYY(date) {
    return (date.getDate() < 10 ? '0' : '') + date.getDate() + '.' +
      ((date.getMonth() + 1) < 10 ? '0' : '') + (date.getMonth() + 1) + '.' +
      date.getFullYear();
  }

  // Універсальне форматування дати та часу
  const formatDateTime = (date, repay, dayW = 1) => {
    let dateTime = new Date(date);

    const year = dateTime.getFullYear();
    const month = dateTime.getMonth() + 1;
    const day = dateTime.getDate();
    const hour = dateTime.getHours();
    const min = dateTime.getMinutes();
    const sec = dateTime.getSeconds();

    const yearGood = year.toString().padStart(4, '0');
    const monthGood = month.toString().padStart(2, '0');
    const dayGood = day.toString().padStart(2, '0');
    const hourGood = hour.toString().padStart(2, '0');
    const minGood = min.toString().padStart(2, '0');
    const secGood = sec.toString().padStart(2, '0');

    switch (repay) {
      case 'dd.mm.yyyy':
        return dayW ? `${dayGood}.${monthGood}.${yearGood}, ${DayDate(date)}` : `${dayGood}.${monthGood}.${yearGood}`;
      case 'hh:mm:ss':
        return `${hourGood}:${minGood}:${secGood}`;
      case 'hh:mm':
        return `${hourGood}:${minGood}`;
    }
  };

  // Повертає скорочену назву дня тижня
  function DayDate(d) {
    const days = {
      0: 'нд',
      1: 'пн',
      2: 'вт',
      3: 'ср',
      4: 'чт',
      5: 'пт',
      6: 'сб',
    };
    if (!d) d = new Date();
    return days[d.getDay()];
  }

  // Налаштовує пошук по таблиці при введенні тексту
  $(document).ready(readyTable);
  function readyTable() {
    $('.input-search').on('keyup mouseup', function () {
      const _this = this;
      const selector = this.getAttribute('somethingSearch'); // Отримуємо селектор елементів для пошуку
      $.each($(selector), function () {
        const text = $(this).text().toLowerCase();
        const searchVal = $(_this).val().toLowerCase();
        $(this).toggle(text.includes(searchVal)); // Показати/сховати елемент
      });
    });
  }

  // Перетворює рядок у число з двома знаками після коми
  function strongToNumber(str) {
    const replaceSpace = str.replace(/\s+/g, ''); // Видаляємо пробели
    const replacePoint = replaceSpace.replace(',', '.'); // Заміняємо кому на крапку
    const parsFlo = parseFloat(replacePoint); // Переводимо у число
    return parsFlo.toFixed(2); // Округляємо до 2 знаків
  }

  // Виконує передану функцію, якщо пристрій не мобільний
  function searchMobile(func) {
    if (!navigator.userAgent.toLowerCase().includes('mobile')) {
      func();
    }
  }

  // Виконує передану функцію, якщо пристрій мобільний
  function searchMobileNot(func) {
    if (navigator.userAgent.toLowerCase().includes('mobile')) {
      func();
    }
  }

  // Додає виділення рядків таблиці при кліку
  function tableLineSelection() {
    $('.table-line-selection tr').click(function () {
      const currentColor = this.style.backgroundColor;
      if (currentColor !== 'rgb(255, 228, 225)') {
        $(this).css('background', '#FFE4E1'); // Встановлюємо рожевий колір
      } else {
        $(this).css('background', 'transparent'); // Повертаємо прозорий фон
      }
    });
  }

  // Обробляє редагування даних у таблиці та заповнює поля вводу
  function editReestrFinance(data, col) {
    switch (+col) {
      case 1:
        formaReestr.clearRecords(); // Очищаємо форму реєстру
        $('.input-paste-reestr').val(data); // Вставляємо дані в поле
        $('#data-table_filter input').val(data); // Вставляємо дані в поле пошуку
        $('#nav-reestr-tab')[0].click(); // Перемикаємося на вкладку реестра
        break;
      case 2:
        formaFin.clearRecords(); // Очищаємо форму фінансів
        $('.input-paste-finance').val(data); // Вставляємо дані в поле
        $('#nav-fin-tab')[0].click(); // Перемикаємося на вкладку фінансів
        break;
    }
  }

  // Додає обробники подій кліку та торкання для таблиць
  function clickTables(sel, fun) {
    const el = document.querySelector(sel);
    if (el) {
      el.addEventListener('click', fun); // Додаємо обробник кліку
      el.addEventListener('touchend', fun); // Додаємо обробник торкання
    }
  }

  // Витягує текстовий вміст із набору елементів <td>
  function getDataFromTd(tdArr) {
    return tdArr.map(item => item.textContent); // Перетворюємо <td> у текст
  }

  // Витягує число з кінця рядка
  function numEndStrong(string) {
    const res = string.match(/\d+$/); // Шукаємо цифри в кінці рядка
    return res[0]; // Повертаємо знайдене число
  }

  // Імітує подію keyup для автоматичного пошуку
  function autoSearchOnOpen(selektor) {
    $(selektor).triggerHandler('keyup'); // Імітуємо подію keyup
  }

  // Імітує подію keyup для елемента
  function autoSearchOnOpenNew(elem) {
    const event = new Event('keyup'); // Створюємо подію keyup
    elem.dispatchEvent(event); // Викликаємо подію на елементі
  }
</script>