<div id="mypopup"></div>

<style>
  #mypopup {
    width: 750px;
    padding: 20px;
    font-size: 8pt;
    border-radius: 6px;
    position: absolute;
    display: none;
    background-color: rgba(255, 255, 255, 0.8); /* Білий фон із 80% непрозорістю */
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2); /* Додаємо тінь для кращого вигляду */
  }
</style>

<script>
  const mypopup = document.getElementById("mypopup");
  const dataTable = document.getElementById("data-table");
  const rowdatafin = document.getElementById("rowdatafin");

  // Додаємо слухачів подій один раз
  dataTable.addEventListener("mouseover", showPopup);
  dataTable.addEventListener("mouseout", () => {
    mypopup.style.display = "none";
  });

  function showPopup(e) {
    const cell = e.target._DT_CellIndex;
    if (!cell || cell.column !== 0) return;

    const projectNum = getProjectNumberFromRow(e.target);
    if (!projectNum) return;

    // Позиціонування попапу
    const { right, top } = e.target.getBoundingClientRect();
    mypopup.style.left = `${right - 20}px`;
    mypopup.style.display = "block";

    // Вставка вмісту
    mypopup.innerHTML = popupInsertText(projectNum);
    mypopup.querySelectorAll("input").forEach((el) => {
      el.style.fontSize = "8pt";
    });

    // Очищення інших елементів
    rowdatafin.innerHTML = "";
    document.querySelectorAll(".delete-fin, .delete-fin-pop").forEach((elem) => {
      elem.remove();
    });

    // Визначення позиції по Y
    const height = mypopup.offsetHeight;
    mypopup.style.top =
      window.scrollY < 200
        ? `${window.scrollY + top - 60}px`
        : `${window.scrollY + top - height + 40}px`;
  }

  function popupInsertText(projectNum) {
    localStorage.removeItem("test");

    // Форматування номера проєкту
    const proektFin = projectNum || "";
    const formattedProektFin = trimStrong(proektFin) || proektFin;

    // Оновлення полів вводу
    updateInputValue("proektfin", formattedProektFin);
    updateInputValue("searchFinance", formattedProektFin);

    // Виклик пошуку
    SearchRecordsFinProekt1(proektFin);

    // Повернення результату
    return localStorage.getItem("test") || "";
  }

  function getProjectNumberFromRow(cell) {
    // Отримуємо номер проєкту з 5-ї колонки ("Проєкт", індекс 4)
    const projectCell = cell.parentNode.querySelector("td:nth-child(5)");
    return projectCell?.innerHTML || "";
  }

  function updateInputValue(id, value) {
    // Універсальна функція для оновлення значення input
    const input = document.getElementById(id);
    if (input) input.value = value;
  }

  function trimStrong(string) {
    // Оптимізована версія: повертає очищений рядок або порожній
    return typeof string === "string" && string.trim() || "";
  }
</script>