<!-- <script>

  function startTableReestrClear(){
    $("#firmareestr-datalist").empty();
    $("#rabotareestr-datalist").empty();
    $("#coderabotareestr-datalist").empty();
    $("#proektreestr-datalist").empty();
    $("#sotrreestr-datalist").empty();
    $("#ispolreestr-datalist").empty();
    $("#primreestr-datalist").empty();
    $("#primmoyoreestr-datalist").empty();
  }   

  function startTableReestr(){
    startTableReestrClear()
    
    google.script.run.withSuccessHandler((arrayOfArrays) => {
      afterDropDownReturned(arrayOfArrays, 'firmareestr-datalist')
    }).getDropDownArrayFirma()
    
    
    google.script.run.withSuccessHandler((arrayOfArrays) => {
      afterDropDownReturned(arrayOfArrays, 'rabotareestr-datalist')
    }).getDropDownArrayRabota()
    
    
    google.script.run.withSuccessHandler((arrayOfArrays) => {
      afterDropDownReturned(arrayOfArrays, 'coderabotareestr-datalist')
    }).getDropDownArrayCodeRabota()
  
    
    google.script.run.withSuccessHandler((arrayOfArrays) => {
      afterDropDownReturned(arrayOfArrays, 'proektreestr-datalist')
    }).getDropDownArrayProekt()

    
    google.script.run.withSuccessHandler((arrayOfArrays) => {
      afterDropDownReturned(arrayOfArrays, 'sotrreestr-datalist')
    }).getDropDownArraySotr()  

    
    google.script.run.withSuccessHandler((arrayOfArrays) => {
      afterDropDownReturned(arrayOfArrays, 'ispolreestr-datalist')
    }).getDropDownArrayIspol()

    
    google.script.run.withSuccessHandler((arrayOfArrays) => {
      afterDropDownReturned(arrayOfArrays, 'primreestr-datalist')
    }).getDropDownArrayPrim()

    
    google.script.run.withSuccessHandler((arrayOfArrays) => {
      afterDropDownReturned(arrayOfArrays, 'primmoyoreestr-datalist')
    }).getDropDownArrayPrimMoyoReestr()
  } 

  // cрабатывание по кнопке Enter
  function clickPressReestrSearch(event) {
    if (event.keyCode == 13) {
        SearchRecordsReestr()
    }
  }
  function clickPressReestrUpdate(event) {
    if (event.keyCode == 13) {
        UpdateRecordReestr(parseInt(document.activeElement.id.replace(/[^\d]/g, '')))
    }
  }

function SearchRecordsReestr() {
  var dateendReestr = document.getElementById("dateendreestr").value;
    var datestartReestr = document.getElementById("datestartreestr").value;
    var firmaReestr = document.getElementById("firmareestr").value;
    var rabotaReestr = document.getElementById("rabotareestr").value;
    var coderabotaReestr = document.getElementById("coderabotareestr").value;
    var proektReestr = document.getElementById("proektreestr").value;
    var sotrReestr = document.getElementById("sotrreestr").value;
    var ispolReestr = document.getElementById("ispolreestr").value;
    var sumispolReestr = document.getElementById("sumispolreestr").value;
    var sumoplataReestr = document.getElementById("sumoplatareestr").value;
    var primReestr = document.getElementById("primreestr").value;
    var primMoyoReestr = document.getElementById("primmoyoreestr").value;
    var issuepartReestr = document.getElementById("issuepartreestr").checked;
    var withoutaccountReestr = document.getElementById("withoutaccountreestr").checked;
    var stoppedReestr = document.getElementById("stoppedreestr").checked;

    // остановка скриипта, если не выбраны критерии поиска в инпутах
    const dataArr = 
    [
      dateendReestr, datestartReestr, firmaReestr, rabotaReestr, coderabotaReestr, proektReestr, sotrReestr, ispolReestr, sumispolReestr, sumoplataReestr, primReestr, primMoyoReestr, issuepartReestr, withoutaccountReestr, stoppedReestr
    ]
    let selector = '#rowdatareestr';
    if(searchStop(dataArr, selector)){
      searchStop(dataArr, selector)
      $('#btnSearchReestr').prop( "disabled", false );
      return
    }   

    var row_number_reestr = 0;
    spinner('rowdatareestr')
    google.script.run.withSuccessHandler(function(ar) 
    {
      var displayTableReestr = '<form>';
      displayTableReestr += '<table onkeypress=\"clickPressReestrUpdate(event)\" class=\"table table-bordered border-danger mb-2 mt-2\" id=\"mainTableReestr\" >';
      displayTableReestr += "<tr>";
      displayTableReestr += "<th>Найдено:</th>";
      displayTableReestr += "<th></th>";
      displayTableReestr += "<th></th>";
      displayTableReestr += "<th></th>";
      displayTableReestr += "</tr>";
      
    ar.forEach(function(item, index) 
    {

      displayTableReestr += "<tr id=\"ROWNUMBER:"+ row_number_reestr +"\" >";

      displayTableReestr += "<td colspan=\"9\">"
      displayTableReestr += "<div class=\"row g-1 mt-1\">"
      
      displayTableReestr += "<div class=\"col-auto\">"
      displayTableReestr += "<label for=\"up_dateendreestr\">Дата конец</label>  ";
      displayTableReestr += "<input type=\"date\" id=\"up_dateendreestr"+ row_number_reestr +"\" value=\""+item[0]+"\" class=\"form-control form-control-sm\" /></div> ";

      displayTableReestr += "<div class=\"col-auto\">"
      displayTableReestr += "<label for=\"up_datestartreestr\">Дата начало</label> ";
      displayTableReestr += "<input type=\"date\" id=\"up_datestartreestr"+ row_number_reestr +"\" value=\""+item[1]+"\" class=\"form-control form-control-sm\" />"
      displayTableReestr += "</div>";
      
      displayTableReestr += "<div class=\"col-md-5\">"
      displayTableReestr += "<label for=\"up_firmareestr\">Фирма</label> ";
      displayTableReestr += "<input type=\"text\" list=\"firmareestr-datalist\" id=\"up_firmareestr"+ row_number_reestr +"\" value=\""+item[2]+"\" class=\"form-control form-control-sm\" /> <datalist id=\"firmareestr-datalist\"></datalist></div>";

      displayTableReestr += "<div class=\"col-md-2\">"
      displayTableReestr += "<label for=\"up_rabotareestr\">Работа</label> "; 
      displayTableReestr += "<input type=\"text\" list=\"rabotareestr-datalist\" id=\"up_rabotareestr"+ row_number_reestr +"\" value=\""+item[3]+"\" class=\"form-control form-control-sm\" /><datalist id=\"rabotareestr-datalist\"></datalist></div>";

      displayTableReestr += "<div class=\"col-md-1\">"
      displayTableReestr += "<label for=\"up_coderabotareestr\">Код раб</label> "; 
      displayTableReestr += "<input type=\"text\" id=\"up_coderabotareestr"+ row_number_reestr +"\" value=\""+item[4]+"\" class=\"form-control form-control-sm\" /></div>";
      
      displayTableReestr += "<div class=\"col-md-2\">"
      displayTableReestr += "<label for=\"up_proektreestr\">Проект</label> ";
      displayTableReestr += "<input type=\"number\" id=\"up_proektreestr"+ row_number_reestr +"\" value=\""+item[5]+"\" class=\"form-control form-control-sm form-font\" /></div>";
      
      
      displayTableReestr += "<div class=\"col-auto\">"
      displayTableReestr += "<label for=\"up_sotrreestr\">Сотрудник</label> ";
      displayTableReestr += "<input type=\"text\" id=\"up_sotrreestr"+ row_number_reestr +"\" value=\""+item[6]+"\" class=\"form-control form-control-sm\" /></div>";          

      displayTableReestr += "<div class=\"col-auto\">"
      displayTableReestr += "<label for=\"up_ispolreestr\">Исполнитель</label> ";
      displayTableReestr += "<input type=\"text\" list=\"ispolreestr-datalist\"  id=\"up_ispolreestr"+ row_number_reestr +"\" value=\""+item[7]+"\" class=\"form-control form-control-sm\" /><datalist id=\"ispolreestr-datalist\"></datalist></div>";          

      displayTableReestr += "<div class=\"col-md-2\">"

      displayTableReestr += "<label for=\"up_sumispolreestr\">Сумма исполнителю</label> ";
      displayTableReestr += "<input type=\"number\" id=\"up_sumispolreestr"+ row_number_reestr +"\" value=\""+item[8]+"\" class=\"form-control form-control-sm\" /></div>";

      displayTableReestr += "<div class=\"col-md-2\">"

      displayTableReestr += "<label for=\"up_sumoplatareestr\">Оплата исполнителю</label> ";
      displayTableReestr += "<input type=\"number\" id=\"up_sumoplatareestr"+ row_number_reestr +"\" value=\""+item[9]+"\" class=\"form-control form-control-sm\" /></div>";

      displayTableReestr += "<div class=\"col-md-4\">"

      displayTableReestr += "<label for=\"up_primreestr\">Примечание к проекту</label> ";
      displayTableReestr += "<input type=\"text\" list=\"primreestr-datalist\" id=\"up_primreestr"+ row_number_reestr +"\" value=\""+item[10]+"\" class=\"form-control form-control-sm\" /><datalist id=\"primreestr-datalist\"></datalist></div>";

      displayTableReestr += "<div class=\"col-md-4\">"
      displayTableReestr += "<label for=\"up_primmoyoreestr\">Примечание мое</label> ";
      displayTableReestr += "<input type=\"text\" list=\"primmoyoreestr-datalist\"  id=\"up_primmoyoreestr"+ row_number_reestr +"\" value=\""+item[11]+"\" class=\"form-control form-control-sm\" /><datalist id=\"primmoyoreestr-datalist\"></datalist></div></div>";

      displayTableReestr += "<div class=\"row g-1 mt-1\">"
      displayTableReestr += "<div class=\"col-auto\">"
      displayTableReestr += "<div class=\"form-check\">"
      displayTableReestr += "<label for=\"up_issuepartreestr\">Выставлено частично</label> ";
      displayTableReestr += "<input type=\"checkbox\" id=\"up_issuepartreestr"+ row_number_reestr +"\" class=\"form-check-input\" "
      displayTableReestr += check1(item[12])
      displayTableReestr += "/></div> </div>";

      displayTableReestr += "<div class=\"col-auto\">"
      displayTableReestr += "<div class=\"form-check\">"
      displayTableReestr += "<label for=\"up_withoutaccountreestr\">Без счета</label> ";
      displayTableReestr += "<input type=\"checkbox\" id=\"up_withoutaccountreestr"+ row_number_reestr +"\" value=\""+item[13]+"\" class=\"form-check-input\" ";
      displayTableReestr += check1(item[13])
      displayTableReestr += "/> </div></div>";

      displayTableReestr += "<div class=\"col-auto\">"
      displayTableReestr += "<div class=\"form-check\">"
      displayTableReestr += "<label for=\"up_stoppedreestr\">Остановлено</label> ";
      displayTableReestr += "<input type=\"checkbox\" id=\"up_stoppedreestr"+ row_number_reestr +"\" value=\""+item[14]+"\" class=\"form-check-input\" ";
      displayTableReestr += check1(item[14])
      displayTableReestr += "/> </div></div>";

      displayTableReestr += "<div id=\"rowdatafin1" + row_number_reestr + "\"></div>"
      
      displayTableReestr += "<td><div class=\"d-grid gap-2\"> ";

      displayTableReestr += "<input type=\"button\" id=\"update_button_reestr"+ row_number_reestr +"\" value=\"Update\" class=\"btn btn-danger\" ";
      displayTableReestr += "onclick=\"UpdateRecordReestr("+row_number_reestr+")\" /> ";
      
      displayTableReestr += "<input type=\"button\" id=\"finance_button_reestr"+ row_number_reestr +"\" value=\"Finance\" class=\"btn btn-danger\" ";
      displayTableReestr += "onclick=\"FinanceRecordReestr("+row_number_reestr+")\" />";
      
      displayTableReestr += "<input type=\"button\" id=\"finance_button_reestr_close"+ row_number_reestr +"\" value=\"FinClose\" class=\"btn btn-danger\" ";
      displayTableReestr += "onclick=\"FinanceRecordReestrClose("+row_number_reestr+")\" /></div> ";
      
      /* displayTableReestr += "<td><div style=\"padding: 5px\"> ";

      displayTableReestr += "<input type=\"button\" id=\"update_button_reestr"+ row_number_reestr +"\" value=\"Update\" class=\"btn btn-danger\" ";
      displayTableReestr += "onclick=\"UpdateRecordReestr("+row_number_reestr+")\" /></div> ";

      
      displayTableReestr += "<div style=\"padding: 5px\" > "; */

    /*           displayTableReestr += "<input type=\"button\" id=\"delete_button_Reestr"+ row_number_reestr +"\" value=\"Delete\" class=\"btn btn-danger\" ";
      displayTableReestr += "onclick=\"DeleteRecordReestr("+row_number_reestr+")\" /></div> "; */


      displayTableReestr += "</td>";
      displayTableReestr += "</tr>";
      row_number_reestr++;    
    });

    displayTableReestr += '</table></form>'
    displayTableReestr += "<div id=\"rowdatafinanchor\"></div>";     
    document.getElementById("rowdatareestr").innerHTML = displayTableReestr;
    // $("#rowdatareestr").attr("tabindex",-1).focus();
    // startTableReestr()
  $('#btnSearchReestr').prop( "disabled", false );
      }).searchRecordsReestrGs(dateendReestr,datestartReestr, firmaReestr, rabotaReestr, coderabotaReestr, proektReestr, sotrReestr, ispolReestr, sumispolReestr, sumoplataReestr, primReestr, primMoyoReestr, issuepartReestr, withoutaccountReestr, stoppedReestr);
}

function ClearRecordReestr() {
  document.getElementById("dateendreestr").value = ''
  document.getElementById("datestartreestr").value = ''
  document.getElementById("firmareestr").value = ''
  document.getElementById("rabotareestr").value = ''
  document.getElementById("coderabotareestr").value = ''
  document.getElementById("proektreestr").value = ''
  document.getElementById("sotrreestr").value = ''
  document.getElementById("ispolreestr").value = ''
  document.getElementById("sumispolreestr").value = ''
  document.getElementById("sumoplatareestr").value = ''
  document.getElementById("primreestr").value = ''
  document.getElementById("primmoyoreestr").value = ''
  document.getElementById("issuepartreestr").checked = false
  document.getElementById("withoutaccountreestr").checked = false
  document.getElementById("stoppedreestr").checked = false
}

function UpdateRecordReestr(row_number_reestr) {
  document.getElementById("update_button_reestr"+row_number_reestr).disabled = true;
  var dateendReestr = document.getElementById("up_dateendreestr"+row_number_reestr).value;
  var datestartReestr = document.getElementById("up_datestartreestr"+row_number_reestr).value;
  var firmaReestr = document.getElementById("up_firmareestr"+row_number_reestr).value;
  var rabotaReestr = document.getElementById("up_rabotareestr"+row_number_reestr).value;
  var coderabotaReestr = document.getElementById("up_coderabotareestr"+row_number_reestr).value;
  var proektReestr = document.getElementById("up_proektreestr"+row_number_reestr).value;
  var sotrReestr = document.getElementById("up_sotrreestr"+row_number_reestr).value;
  var ispolReestr = document.getElementById("up_ispolreestr"+row_number_reestr).value;
  var sumispolReestr = document.getElementById("up_sumispolreestr"+row_number_reestr).value;
  var sumoplataReestr = document.getElementById("up_sumoplatareestr"+row_number_reestr).value;
  var primReestr = document.getElementById("up_primreestr"+row_number_reestr).value;
  var primMoyoReestr = document.getElementById("up_primmoyoreestr"+row_number_reestr).value;
  var issuepartReestr = document.getElementById("up_issuepartreestr"+row_number_reestr).checked;
  var withoutaccountReestr = document.getElementById("up_withoutaccountreestr"+row_number_reestr).checked;
  var stoppedReestr = document.getElementById("up_stoppedreestr"+row_number_reestr).checked;

  google.script.run.withSuccessHandler(function(return_string) 
  {
      document.getElementById("update_button_reestr"+row_number_reestr).disabled = false;
  }).UpdateRecordReestrGs(dateendReestr,datestartReestr, firmaReestr, rabotaReestr, coderabotaReestr, proektReestr, sotrReestr, ispolReestr, sumispolReestr, sumoplataReestr, primReestr, primMoyoReestr, issuepartReestr, withoutaccountReestr, stoppedReestr);
}

function FinanceRecordReestr(row_number_reestr){
  document.getElementById("finance_button_reestr"+row_number_reestr).disabled = true;
    const promise1 = new Promise((resolve, reject) => {
      var proektFin = document.getElementById("up_proektreestr"+row_number_reestr).value;
      resolve(SearchRecordsFinProekt1(proektFin));
    });
  promise1.then(() => {
  console.log(document.getElementById("rowdatafinanchor").innerHTML)
  let rowdatafin = document.getElementById("rowdatafinanchor").innerHTML
  document.getElementById("rowdatafinanchor").innerHTML = ''
  document.getElementById("rowdatafin1"+ row_number_reestr).innerHTML = rowdatafin
  });        
  document.getElementById("finance_button_reestr"+row_number_reestr).disabled = false;
} 
  
function FinanceRecordReestrClose(row_number_reestr){
  let rowdatafin = document.getElementById("rowdatafinanchor").innerHTML
  document.getElementById("rowdatafinanchor").innerHTML = ''
  document.getElementById("rowdatafin1"+ row_number_reestr).innerHTML = rowdatafin
} 
    
function check1(item){
  if(item === true){
    return 'checked'
  }else{
    return ''
  }
}

// открытие полной таблицы проекта
function btnTable() {
  $('#div-data-table').remove();
    $('#btnTable').prop( "disabled", true );
    $('<div id="div-data-table-spinner"></div><div id="div-data-table"><table id="data-table" class="table table-striped table-sm table-hover table-bordered table-datatable table-line-selection "></table></div>').appendTo('#div-data-table-row')
    $("#div-data-table-spinner").attr("tabindex",-1).focus();
    spinner('div-data-table-spinner') 
    google.script.run.withSuccessHandler(showData).getData()
    //tableLineSelection() //полосы в таблице
}

// открытие полной таблицы проектов при загрузке окна (автооткрытие)
searchMobile(btnTable);

  
function showData(dataArray){
  $(document).ready(function(){
    sessionStorage.setItem('DataLength', dataArray.length);//записываем в кеш длину массива
    let oTable = $('#data-table').DataTable({
      data: dataArray,
      //CHANGE THE TABLE HEADINGS BELOW TO MATCH WITH YOUR SELECTED DATA RANGE
      lengthMenu: [[50, 100, 500, -1, 0], [50, 100, 500, "Все", "Пусто"]],
      responsive: true,
      order: [[ 10, 'desc' ]], // колонка 10 это номера строк, по ним сортировка
      columnDefs: [
          {
          targets: [ 10 ],
          visible: false,
          }, // скрываем колонку номеров сттрок
      ],
      columns: [
        {"title":"Дата конец"},
        {"title":"Дата начало"},
        {"title":"Фирма"},
        {"title":"Работа"},
        {"title":"Проект"},
        {"title":"Сотрудник"},
        {"title":"Исполнитель"},
        {"title":"Сумма исполу"},
        {"title":"Оплата исполу"},
        {"title":"Примечание"},
        {"title":"Row"},
      ]
    });
      
/* // при поиске если введены критерии поиска, то ищется по всей таблице, если строка поиска пустая, то отображается количество строк по умолчанию
$('#searchReestr').keyup(function() {
  if(this.value === '') {
    oTable.context["0"]._iDisplayLength = 50;  
  }else{
    oTable.context["0"]._iDisplayLength = -1;  
  }
  oTable.draw();
}); */

  }); 
  $("#div-data-table-spinner").remove()
  $('#btnTable').prop( "disabled", false);
  
  clickTableReestr();
}

/* function showDataReestr(dataArray){
  var result = "<table class='table table-bordered table-hover ' style='font-size:0.8em'>"    
  // строим таблицу
  for(var i=dataArray.length-1; i>0; i--) {
    result += "<tr>";
    for(var j=0; j<dataArray[i].length; j++){
      result += "<td>"+dataArray[i][j]+"</td>";
    }
    result += "<td><button type=\"button\" id=\"buttonModalReestr"+ i +"\"  something= "+ i +" class=\"btn btn-sm btn-light btnbtnfin\" data-bs-toggle=\"modal\" data-bs-target=\"#exampleModalReestr\"  />Edit</button></td>";
    result += "</tr>";
  }
  result += "</table>";
  var div = document.getElementById('div-data-table');
  div.innerHTML = result;
  $('#btnTable2').prop( "disabled", false ); 
  $("#div-data-table-spinner").remove()
  //полосы в таблице
  $("table tr").click(function() {
  // $("table tr").css("background", "#FFFFFF"); //reset to original color
    if(!this.style.background){
      $(this).css("background", "#FFE4E1"); //apply the new color  
    }else{
      $(this).css("background", "#FFFFFF");
    }    
  });
} */

//возвращает текст из определенной колонки и номер колонки, записыает в кеш, потом вставляет из кеша
function clickTableReestr() {
  const el = document.querySelector('.table-line-selection');
  if(el) {
    el.addEventListener("click", clickTapHandling);
    el.addEventListener('touchcancel', clickTapHandling);
  };
} 

//обработка клика или тапа по таблице 
function clickTapHandling(event) {
  const row = event.srcElement._DT_CellIndex.row;
  const sesStorage = sessionStorage.getItem('DataLength');
  const data = document.querySelector('#data-table').rows[sesStorage-row].cells[4];
  let target = event.target; // где был клик?
  if (target.tagName != 'TD') return; // не на TD? тогда не интересует
    switch (event.srcElement._DT_CellIndex.column) {
      case 0:
        sessionStorage.setItem('Data1', target.innerHTML);
        break;
      case 1:
        sessionStorage.setItem('Data2', target.innerHTML);
        break;
      case 2:
        sessionStorage.setItem('Firma', target.innerHTML);
        break;
      case 3:
        sessionStorage.setItem('Rabota', target.innerHTML);
        break;
      case 4:
        sessionStorage.setItem('Proekt', target.innerHTML);
        break;
      case 5:
        sessionStorage.setItem('Sotr', target.innerHTML);
        break;
      case 6:
        sessionStorage.setItem('Ispol', target.innerHTML);
        break;
      case 7:
        sessionStorage.setItem('Sum_ispolu', target.innerHTML);
        break;
      case 8:
        sessionStorage.setItem('Oplata_ispolu', target.innerHTML);
        break;
      case 9:
        sessionStorage.setItem('Prim', target.innerHTML);
        break;
    };    
  // вставка значения из кеша на кнопку и в поле поиска таблицы
  document.getElementById('btnSearchReestrInfo').innerHTML=data.innerHTML;
  document.getElementById('btnSearchFinInfo').innerHTML='fin';
  document.getElementById('btnSearchJobInfo').innerHTML='job';
  document.querySelector('#data-table_filter input').value=target.innerHTML;
}; 



//обработка кнопок

// открытие полной таблицы проекта по клику на кнопку
$('#btnTable').click(btnTable)

//кнопка маленькая левая (reestr)
$('#btnSearchReestrInfo').click(function() {
  $('#proektreestr').val(sessionStorage.getItem('Proekt'));
    SearchRecordsReestr();
});

//кнопка маленькая средняя (finance)
$('#btnSearchFinInfo').click(function() {
  $('#proektfin').val(sessionStorage.getItem('Proekt'));  
});

//кнопка маленькая правая (job)
$('#btnSearchJobInfo').click(function() {
  $('#proektjob').val(sessionStorage.getItem('Proekt'));  
});

$('#btnSearchReestr').click(function(){
  $('#btnSearchReestr').prop( "disabled", true );
   SearchRecordsReestr();   
});

$('#btnClearSearchReestr').click(function(){
  $('#btnClearSearchReestr').prop( "disabled", true );
  $('#rowdatareestr').html('');
  $('#btnClearSearchReestr').prop( "disabled", false );
});

$('#btnTable2').click(function(){
  $('#div-data-table').remove();
  $('#btnTable2').prop( "disabled", true );
  $('<div id="div-data-table-spinner"></div><div id="div-data-table"></div>').appendTo('#div-data-table-row')
  $("#div-data-table-spinner").attr("tabindex",-1).focus();
  spinner('div-data-table-spinner'); 
  google.script.run.withSuccessHandler(showDataReestr).getData2();
});

$('#clearBtnTable').click(function(){
  $('#clearBtnTable').prop( "disabled", true );
  $('#div-data-table').remove();
  $('#clearBtnTable').prop( "disabled", false );
})

</script> -->